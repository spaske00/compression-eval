#!/bin/bash

if [[ $# -ne 3 ]]; then
    echo "Usage: $0 <input-dir> <section-name> <output-dir>"
    echo "Example: $0 corpus/ .text corpus-text/"
    exit 1
fi

DIR="$1"
SECTION_NAME="$2"
OUTPUT_DIR="$3"

mkdir -p "$OUTPUT_DIR"

while IFS= read -r -d '' file; do
    echo "Dumping $file"
    output_file="$(basename $file)_${SECTION_NAME#.}" 
    objcopy --dump-section "${SECTION_NAME}=${OUTPUT_DIR%/}/${output_file}" "$file"
done < <(find "$DIR" -type f -print0)