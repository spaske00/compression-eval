#!/bin/bash

DIR="$1"

if [[ -z "$DIR" ]]; then
    echo "Usage: $0 <directory>"
    echo "Example: $0 corpus/"
    exit 1
fi

dt=$(date +%s)
output_file="$PWD/results/results_${DIR//\//\_}entropy_$dt.csv"

cd "$DIR"

# Print header
echo -n 'filename,' > "$output_file"
echo '' | ent -t -b | head -n 1 >> "$output_file"

for file in $(find . -type f -name '*.tar' | sort); do
    echo "Processing: $file"
    echo -n "$file," >> "$output_file"
    ent -t -b "$file" | tail -n 1 >> "$output_file"
done

